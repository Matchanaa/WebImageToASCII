using NUnit.Framework;
using Moq;
using System.Drawing;
using System.Drawing.Imaging;
using WebImageToAscii.Controllers;
using WebImageToAscii.Services;
using System.IO;
using Microsoft.AspNetCore.Http;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Mvc;

namespace WebImageToAsciiNUnitTesting
{
  public class ImageControllerTest
  {
    private ImageController imageController;

    private Mock<IExtensionChecks> mockExtensionChecks;
    private Mock<IResizeImage> mockResizeImage;
    private Mock<IImageConverter> mockImageConverter;

    IFormCollection formData;

    private readonly Bitmap resizedImage = new Bitmap(@"Test Data\TestResizedImage.png");
    private readonly string testAscii = "MMMMMMMMMMMMMMMMMMMMMMOO,,````````````````````````````````````````````````````````````````````````````````,,^^^^^^^^^^^^^^;;>>^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^````````````````````````````````````````````^^**``````````````````````````````````````````````````````````````````````````````````````\"\">>``''TT\r\nMMMMMMMMMMMMMMMMMMMMMM//````::````````````````````````````````````````````````````````````````````````````''^^^^^^^^^^^^^^>>==^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\"\"````````````````````````````````,,>>````,,XXMMMM^^``````````````````````````````````````````````````````````````````````````````````````^^++^^cc\r\nMMMMMMMMMMMMMMMMMMMM]];;^^__,,``````````````````````````````````````````````````````````````````````````````^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^``````````````````````````````````````^^88;;``\"\"GGMMMMMMJJ````````````````````````````````````````````````````````````````````````````````ff;;``,,>>^^;;\r\nMMMMMMMMMMMMMMMMMMMMCC;;,,````````````````````````````````````````````'',,,,\"\"``''``````````````````````````,,^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^::``````````````````````````````````^^{{$$MM$$KKEEMMMMMMMMkk''``````````````````````````````````````````````````````````````````````````````````````^^^^ee\r\nMMMMMMMMMMMMMMMMMMMM\\\\\"\"``````````````````````````````````''\"\",,\"\"\"\",,::::::::,,::,,``````````````````````````^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^,,``````````````````````````````````AAMMMMMMMMMMMMMMMMMM$$;;``````````````````````````````````````````````````````````````````````````TT''````<<\"\"vv^^^^;;\r\nOOMMMMMMMMMMMMMMMMee``^^````````````````````````````````,,::::::::::::::::::::::::,,``````````````````````````,,^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^,,````````````````````````````````''BBMMMMMMMMMMMMMMMMMMGG````````````````````````````````````````````````````````````````````````````::``````cc,,11^^//>>\r\n((MMMMMMMMMMMMMMMMkk,,;;``````````````````````````````''::::::::::::::::::::::::::\"\"````````````````````````````__^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^::^^::^^^^^^^^^^^^__``````````````````````````````,,\\\\MMMMMMMMMMMMMMMMMMMMMM^^````````````````````````````````````````````````````````````````````````````````^^``,,^^^^TTLL\r\n\"\"SSAA$$MMMMMMMMMMMM::````````````````````````````````''::::::::::::::::::::::::::''``````````````````````````````__^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^,,````,,^^^^^^^^\"\"::^^````````''``````````````````''``PPMMMMMMMMMMMMMMMMMMMMMMcc````````````````````````````````````````````````````````````````````````````````uu__<<PP^^==>>\r\n````>>MMMMMMMMMMMMMM44``````````````````````````````````,,::::::::::::::::::::::::,,````````````````````````````````__^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^,,``````,,''''^^\"\"\"\"^^,,````````````````````````,,\"\"``<<[[MMMMMMMMMMMMMMMMMMMMZZ\"\"````````````````````````````````````````````````````````````````````````````````^^^^;;;;>>DD\r\n````^^qqbbMMMMMMMMMM%%::``````````````````````````````````\"\"::::::::::::::::::::::::''````````````````````````````````,,^^^^^^^^^^^^^^^^^^^^^^,,````^^__,,````````````````,,\"\"__::````````````````````````````````11MMMMMMMMMMMMMMMMMMMMmm``````````````````````````````````````````````````````````````````````````````````^^;;^^^^^^;;\r\n``````````HHMMMMMMMMAA^^````````````````````````````````````,,--          ``::::::::````                          ````````,,__^^__::,,\"\"''``````````````````````````````````````::``````''``````````````````````~~MMMMMMMMMMMMMMMMMMMMMMkk``````````````````````````````````````````````````````````````````````````````````vvff^^^^^^^^\r\n``````````\"\"33MMMMMM^^``````````````````````````````````````,,    LL11<<  ..::::::''````    1111``      ;;11;;    ``````````````````````````````````````````````````````````````\"\"````````````````````````````==$$MMMMMMMMMMMMMMMMMMMMMM55``````````````````````````````````````````````````````````````````````````````````^^^^^^^^^^^^\r\n````````````'']]EEbb``````````````````````````````````````````    gg@@[[  ..::,,,,``````  ::@@@@==      RR@@RR    ``````````````````````````````````````````````````````````````````````````````````````````\"\"OOMMMMMMMMMMMMMMMMMMMMMM$$__````\"\"````````````````````````````````````````````````````````````````````````````::^^^^^^^^^^\r\n``````````````;;22//``````````````````````````````````````````    gg@@[[  --,,\"\",,``````  ::@@@@==      RR@@RR    ``````````````````````````````````````````````````````````````````````````````````````````^^$$MMMMMMMMMMMMMMMMMMMMMMAA__^^__,,````````````````````````````````````````````````````````````````````````````\"\"^^^^^^^^^^\r\n``````````````^^ww^^''````````````````````````````````````````    gg@@[[    ``,,\"\"``````  ::@@@@==                ````````````````````````````\"\"``````````````````````````````````````````````````````````````OOMMMMMMMMMMMMMMMMMMMM$$^^\\\\,,````````````````````````````````````````````''\"\"''````''``````````````````````````^^^^^^^^^^\r\n````````````````CC,,\"\"````````````````````````````````````````    gg@@[[    ``,,````````  ::@@@@==                                  ..````              --``````````````````````                      --``        ..;;llMMMMMMMMMMMMww..          --``````````````````````````''\"\"'''',,::::::,,,,::``````````````````````````,,^^^^^^^^\r\n``````````````````::::````````````````````````````````````````    gg@@[[    ````````````  ::@@@@==      ``__``      ''__    __//^^            ^^vv++^^      ..``````````````````    __,,    --\\\\//^^          ;;!!<<    >>MMMMMM00;;    ^^vv++^^      ..``````````````````,,::::::::::::::::::::::::''``````````````````````````^^^^^^^^\r\n``````````````````''``````````````````````````````````````````    gg@@[[    ````````````  ::@@@@==      RR@@RR      %%@@vvee@@@@@@NN      !!QQ@@@@@@@@QQ++    ..````````````````  ::@@QQ  bb@@@@@@@@gg``  LLQQ@@@@@@@@cc  nnMM00\"\"  !!QQ@@@@@@@@QQ++    ..``````````````,,::::::::::::::::::::::::::````````````````````````````\"\"^^^^^^\r\n``\"\"``````````````````````````````````````````````````````````    gg@@[[                  ::@@@@==      RR@@RR      %%@@%%@@@@&&@@cc    ll@@@@@@&&&&@@@@@@UU    ````````````````  ::@@QQGG@@@@ggQQ@@@@MM**@@@@&&QQ@@@@@@,,  $$^^  ll@@@@@@&&&&@@@@@@UU    ``````````````,,::::::::::::::::::::::::::``````````````````````````````,,^^^^\r\n``''``````````````````````````````````````````````````````````    gg@@&&11111111111111111133@@@@==      RR@@RR      %%@@@@NN    ..    cc@@@@88        ee@@@@<<  --``````````````  ::@@@@@@SS      VV@@@@@@##--    ;;@@@@VV  zz  cc@@@@88        ee@@@@<<  --````````````''::::::::::::::::::::::::::````````````````````````````````,,^^\r\n``````````````````````````````````````````````````````````````    gg@@@@@@@@@@@@@@@@@@@@@@@@@@@@==      RR@@RR      %%@@@@            QQ@@RR    ,,      EE@@MM    ``````````````  ::@@@@[[          @@@@QQ          OO@@##      QQ@@RR            EE@@MM    ``````````````'',,::::::::::::::::::::::,,````````````````````````````````''\r\n''````,,''````````````````````````````````````````````````````    gg@@@@ggggggggggggggggggQQ@@@@==      RR@@RR      %%@@gg    ``    ,,@@@@^^            ^^@@@@--  ``````````````  ::@@@@cc  ..``    QQ@@88    ``    VV@@$$    ,,@@@@^^            ^^@@@@--  ``````````````````::::::::::::::::::::::,,``````````````````````````````````\r\n``\"\"``\"\"::````````````````````````````````````````````````````''  gg@@[[                  ::@@@@==      RR@@RR      %%@@RR    ``..  vv@@@@mmwwwwwwwwwwwwGG@@@@;;  ..````````````  ::@@@@::  ````    QQ@@xx  --``    SS@@$$    vv@@@@mmwwwwwwwwwwwwGG@@@@;;  ..``````````````\"\",,::::::::::::::::::::````````````````````````````````````\r\n``````````````````''``````````````````````````````````````<<mm((  gg@@[[                  ::@@@@==      RR@@RR      %%@@GG    ``..  ff@@@@@@@@@@@@@@@@@@@@@@@@\\\\  ..````````````  ::@@@@''  ````    QQ@@ZZ  --``    SS@@$$    ff@@@@@@@@@@@@@@@@@@@@@@@@\\\\  ..````````````````````'',,,,,,::::::,,\"\"````````````````````````````````````\r\n``````````````,,;;<<``````````````````````````````````````^^QQ77  gg@@[[    ````````````  ::@@@@==      RR@@RR      %%@@GG    ``..  ff@@@@88wwwwwwwwwwwwwwwwww__  ..````````````  ::@@@@``  ````    QQ@@ZZ  --``    SS@@$$    ff@@@@88wwwwwwwwwwwwwwwwww__  ..````````````````````````````,,,,\"\",,''````````````````````````````````````\r\n````````````^^>>>>>>,,````````````````````````````````````zzQQ77  gg@@[[    ````````````  ::@@@@==      RR@@RR      %%@@GG    ``..  vv@@@@                          ````````````  ::@@@@``  ````    QQ@@ZZ  --``    SS@@$$    vv@@@@                          ``````````````````````````````````::``````````````````````````````````````\r\n``````````^^>>>>>>>>^^``````````````````````````VVAA77~~ffWWQQ77  gg@@[[    ````````````  ::@@@@==      RR@@RR      %%@@GG    ````  ,,@@@@LL  ::..--,,  ''ZZ>>    --````````````  ::@@@@``  ````    QQ@@ZZ  --``    SS@@$$    ,,@@@@LL    ----    ''ZZ>>                ..````````````````````'',,``````````````````````````````````````\r\n````````,,88LL>>>>>>^^``````````````````````````<<QQQQQQQQQQQQ77  gg@@[[    ````````````  ::@@@@==      RR@@RR      %%@@GG    ````    WW@@QQ            [[@@@@    ``````````````  ::@@@@``  ````    QQ@@ZZ  --``    SS@@$$      WW@@QQ            [[@@@@                  ``````````````````````````````````````````````````````````````\r\n````^^''==>>>>>>>>>>;;\"\"``''````````````````````TTQQQQQQQQQQQQ77  gg@@[[    ````````````  ::@@@@==      RR@@RR      %%@@GG    ``,,^^  ==@@@@QQ==    ,,kk@@@@PP    ``````````````  ::@@@@``  ````    QQ@@ZZ  --``    SS@@$$      ==@@@@QQ==    ,,kk@@@@PP        1111^^    ``````````````````````````````````````````````````````````````\r\n````CC^^LLVV>>>>>>>>==,,''``,,````````````````\"\"ggQQQQQQQQQQQQ77  gg@@[[    ````````````  ::@@@@==      RR@@RR      %%@@GG    ``__>>    ff@@@@@@@@@@@@@@@@]]    ````````````````  ::@@@@``  ````    QQ@@ZZ  --``    SS@@$$        ff@@@@@@@@@@@@@@@@]]    ..    @@@@FF    ``````````````````````````````````````````````````````````````\r\n``````>>LLnn>>>>>>==::^^^^__\"\"````````````````kkQQQQQQQQQQQQQQ77  gg@@[[  }}**``````````  ::@@@@==      RR@@RR      %%@@GG    ``^^>><<    ^^%%@@@@@@@@QQ))    --````````````````  ::@@@@``  ````    QQ@@ZZ  --``    SS@@$$    ..    ^^%%@@@@@@@@QQ))      ``    @@@@FF    ``````````````````````````````````````````````````````````````\r\nVV````wwLL>>>>>>>>^^''::^^^^^^__''``````````//QQQQQQQQQQQQQQQQ77          KKQQ**````````                                      ``;;>>>><<        ,,::        --``````````````````            ````            --``              ``..        ,,::        --````      $$PP    ``````````````````````````````````````````````````````````````\r\n``````__**88>>//KK,,,,::^^^^^^^^^^::''``````VVQQQQQQQQQQQQQQQQ88ccccccccccNNQQxx````````                                    ..``;;>>>>>>>>^^..            ``````````````````````            ````            ..``--            ``````                ..````..      @@JJ  --``````````````````````````````````````````````````````````````\r\n**cc^^LLLLcc>>**vv^^::::^^^^^^^^^^^^^^__\"\"``ffQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ!!````````````````````````````````````````````````^^>>>>>>>>>>>><<^^\"\"``````````````````````````````````````````````````````````````,,````__''``````````````````````````````      PP@@    ````````\\\\ffvv''````````````````````````````````````````````````\r\n``,,zzXX>>LLww>>>>^^__^^^^^^^^^^^^^^^^^^eemmQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ&&\"\"````````````````````````````````````````````````^^>>>>>>>>>>>>==''````````````````````````````````````````````````````````````````````````''``````````````````````````````..    $$^^    ````LLNNQQQQQQ$$^^``````````````````````````````````````````````\r\n\"\"^^>>LL>>>>++>>>>^^^^^^^^^^^^^^^^^^^^==&&QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ!!````````````````````````````````````````````````::>>>>>>>>>>>>>>>>^^``````````````````````````````````````````````````````````````````````````````,,;;__``````````````````````--        ``````HHQQQQQQQQQQBB``````````````````````````````````````````````\r\nrrff>>22++>>>>>>>>^^^^^^^^^^^^^^^^vv**^^BBQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ##;;````````````````````````````````````````````````^^>>>>>>>>>>>>>>>>>>^^````````````````````````````````````````````````````````````````````````````;;>>>>;;````````````````````````    --````````88QQQQQQQQQQQQ~~````````````````````````````````````````````\r\n^^;;>>!!**LL>>>>>>^^^^^^^^^^^^++TTllccvvOOggQQQQQQQQQQQQQQQQQQQQQQQQQQQQkk``````````````````````````````````````````````````^^>>>>>>>>>>>>>>>>>>,,``````````````````````````````````````````````````````````````````````````^^>>>>>>>>\"\"````````````````````````^^HHzz^^__ffQQQQQQQQQQQQQQPP````````````````````````````````````````````\r\n<<ZZ>>>>>>GG~~>>==^^^^^^^^^^^^;;[[QQQQggVVhhggQQQQQQQQQQQQQQQQQQggQQQQQQgg\"\"````````````````````````````````````````````````\"\">>>>>>>>>>>>>>>>^^``````````````````````````````````````````````````````````````````````````==bb>>>>>>>>''``````````````````````````DDQQQQQQQQQQQQQQQQQQQQQQDD````````````````````````````````````````````\r\n;;nn>>>>>>LL>>>>;;^^^^^^^^^^^^^^^^77AABB&&QQQQQQQQQQQQQQQQ00ff**''//AA%%bbvv``````````````````````````````````````````````````==>>>>>>>>>>>>^^````````````````````````````````````````````````````````````````^^^^``````,,>>LL>>>>>>>>::\"\"``''``````````````````''EEQQQQQQQQQQQQQQQQQQQQQQNN````````````````````````````````````````````\r\n^^>>>>>>>>>>>>>>;;^^^^^^^^^^^^;;^^^^^^^^^^vvww&&QQQQQQQQQQXX,,````````````                            ..````..            ``''>>>>>>>>>>>>__``````````````````````````````````````````````````````````````````^^^^``^^ff<<vv11>>>>>>>>^^\"\"``\"\"``              ``**QQQQQQQQQQQQQQQQQQQQQQQQkk````````````````````````````````````````````\r\n33>>>>>>>>>>>>>>^^^^^^^^^^>>++\\\\~~;;^^^^^^^^^^;;[[QQQQQQ&&cc^^;;++^^^^cc;;    ,,______________,,--        ``..    ____    ````^^>>>>>>>>^^````````````````````````````````````````````````````````````````````````````,,>>!!77>>>>>><<^^^^^^\"\"\"\"    ____\"\"    __MMQQQQQQQQQQQQQQQQQQQQQQQQQQTT``````````````````````````````````````````\r\nLL>>>>>>>>>>>>;;^^^^^^^^^^^^^^cc;;~~;;^^^^^^^^^^^^//ssZZ<<^^^^^^;;^^^^^^``    QQ@@@@@@@@@@@@@@@@@@@@OO^^    ..  ^^@@@@--  ````''>>>><<__````````````````````````````````````````````````````````````````''++````**\\\\``;;VV>>>>>>>>>>\"\"\"\"^^^^^^__    @@@@gg    VVQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQOO````````````````````````````````````````\r\n!!~~>>>>>>>>==^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ss}};;^^^^^^^^__````````    QQ@@@@@@@@@@@@@@@@@@@@@@@@vv      ^^@@@@--  ``````^^,,``````````````````````````````````````````````````````````````````````>>\"\"::''''````;;((((>>ff\\\\``,,^^^^^^^^    @@@@gg  ..WWQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ::``````````````````````````````````````\r\nffvv;;==>>>>;;^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\"\"``````    QQ@@GG              vv@@@@@@``    ^^@@@@--  ``````````````````````````````````````````````````````````````````````````````````^^cc``UU\"\"<<>>++//>>}}~~\"\"__^^^^^^^^    @@@@gg    [[QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ,,``````````````````````````````````````\r\n^^^^^^>>>><<^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^__``````    QQ@@GG                <<@@@@33    ^^@@@@--  ````````              ``````````````..              --````````````              ..``''^^``^^IIzz::``    ``--__^^^^^^^^    @@@@gg  **QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQDD````````````````````````````````````````\r\n^^^^^^==>>;;^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^``````    QQ@@GG    ````````..    QQ@@BB    ^^@@@@--  ````--      ..::..      --````````        ..::\"\"        ..````--      ..__``      ^^::cc''^^__      ,,,,      ``^^^^^^    @@@@MM  ffQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ^^````````````````````````````````````````\r\n^^^^^^;;>>^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^``````    QQ@@GG    ``````````    MM@@MM    ^^@@@@--  ``      xxQQ@@@@@@QQZZ      ````    ,,EE@@@@@@@@@@MM==    ``--    UUQQ@@@@@@@@AA``    \"\"99``  ,,OO@@@@@@@@BB^^    ^^^^    @@@@]]  KKQQQQQQQQQQQQQQQQQQQQQQQQQQQQEE;;``````````````````````````````````````````\r\n^^^^^^==<<^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^__::::''``````    QQ@@GG    ``````````    QQ@@[[    ^^@@@@--  --    gg@@@@@@@@@@@@@@MM    ..    LL@@@@@@@@@@@@@@@@@@~~        $$@@@@@@@@@@@@@@@@``  __``  \\\\@@@@@@@@@@@@@@@@??  --^^``  QQ@@NN  66QQQQQQQQQQQQQQQQQQQQQQQQQQQQ++````````````````````````````````````````````\r\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^``````````````    QQ@@GG                \\\\@@@@}}    ^^@@@@--      %%@@@@ss--    ff@@@@NN        @@@@WW;;      ++@@@@QQ      zz@@@@vv      11@@@@AA  ..  ::@@@@&&<<    __]]@@@@^^  ::''  QQ@@ll  uuQQQQQQQQQQQQQQQQQQQQQQQQQQQQyy````````````````````````````````````````````\r\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^__``````````````    QQ@@GG            \"\"xx@@@@QQ      ^^@@@@--    <<@@@@LL          ==@@@@::    !!@@@@``          11@@@@      DD@@88          TT@@MM      ]]@@WW    ````    ]]@@$$  --..  MM@@33  OOQQQQQQQQQQQQQQ%%99**~~DDWWMMOO,,``````````````````````````````````````````\r\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^,,``````````````    QQ@@@@@@@@@@@@@@@@@@@@@@@@^^  {{  ^^@@@@--    AA@@MM              gg@@PP    ``++??            ^^@@@@--    88@@QQ,,                    @@@@~~            ^^@@@@..  ``  ]]@@ff  22ggQQQQQQQQQQgg~~``````````````````''``````````````````````````````````````\r\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^::``````````````    QQ@@@@@@@@@@@@@@@@@@QQww``  ^^$$  ^^@@@@--    QQ@@$$11111111111111MM@@00                  ^^ff$$@@@@--    <<@@@@@@WWee>>        ``  ;;@@@@xx111111111111ff@@@@>>  __  EE@@//  __^^YYQQQQQQQQ$$<<^^^^;;;;^^;;,,::~~;;,,````````````````````````````````````\r\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\"\"__,,^^^^^^^^^^^^^^````````''````    QQ@@##__________,,        cc$$MM  ^^@@@@--    @@@@@@@@@@@@@@@@@@@@@@@@QQ        ;;AA&&@@@@@@@@@@@@@@--      33@@@@@@@@@@@@[[>>      ++@@@@@@@@@@@@@@@@@@@@@@@@!!  __  bb@@LL  ^^^^^^vvVVAAPP<<^^^^LL>>::^^<<````;;``==````````````````````````````````````\r\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^,,````,,^^____^^\"\",,^^\"\"``````''````    QQ@@GG            --^^77OOMMMMMM  ^^@@@@--    @@@@QQggggggggggggggggggOO      RR@@@@@@@@@@@@%%AA@@@@--  ..    ,,VVQQ@@@@@@@@@@99    zz@@@@gggggggggggggggggggg\\\\  ''  YY@@;;  ^^^^^^LLVV~~^^^^^^^^^^\"\"````````````````````````````````````````````````````\r\n\"\"^^^^^^^^^^^^^^^^^^^^^^^^^^__::^^^^^^,,``````''````::,,''^^,,````````````    QQ@@GG  ``\"\"``''22MMMMMMMMMMMMMM  ^^@@@@--    QQ@@TT                        TT@@@@%%//^^      ^^@@@@--              ''!!NN@@@@@@^^  LL@@@@                        ''  ff@@,,  ^^^^^^^^^^^^^^^^^^^^^^^^````````````````````````````````````````````````````\r\n````::^^^^^^^^^^^^^^^^__::\"\"````__::``````````````````''\"\",,__````````````    QQ@@GG    ``````ssMMMMMMMMMMMMMM  ^^@@@@--    ##@@$$              ^^::      QQ@@[[            vv@@@@--      ^^--          ''@@@@ZZ  \"\"@@@@LL  ``''''``    <<``    ``  ==gg--  ^^^^^^^^^^^^^^^^^^^^^^^^\"\"``````````````````````````````````````````````````\r\n````````,,,,,,\"\"''``````````````````````````````````````````::````````````    QQ@@GG    ````ffMMMMMMMMMMMMMMMM  ^^@@@@--    rr@@@@;;    --    ``@@@@88    @@@@HH    ``--    gg@@@@``    @@@@TT    --      @@@@ff    QQ@@gg    ::__--  YY@@@@,,              ``^^^^^^^^^^^^^^^^^^^^^^,,``````````````````````````````````````````````````\r\n````````````````````````````````````````````````````````````''````````````    QQ@@GG    ``ccMMMMMMMMMMMMMMMMMM  ^^@@@@--      QQ@@@@~~      ,,WW@@@@,,    QQ@@QQ,,      __MM@@@@@@,,    qq@@@@vv        bb@@@@,,    cc@@@@%%``      }}@@@@##        ::__''  ``^^^^^^^^^^^^^^^^^^^^^^,,``````````````````````````````````````````''**~~``\r\n``````````````````````````````````````````````````````````````````````````    QQ@@GG    ,,%%MMMMMMMMMMMMMMMMMM  ^^@@@@--  ''  ^^@@@@@@@@ggQQ@@@@@@{{      //@@@@@@QQggQQ@@@@%%@@@@==    --QQ@@@@@@gg&&@@@@@@PP        55@@@@@@QQgg@@@@@@QQ..  ::    @@@@[[  ``^^^^^^^^^^^^^^^^__^^__``````````````````````````````````<<^^````>>%%MMOO``\r\n``````````````````````````````````````````````````````````````````````````    QQ@@GG    \"\"OOMMMMMMMMMMMMMMMMMM  ^^@@@@--  ``    ''##@@@@@@@@@@QQLL    ..    ff@@@@@@@@@@QQ//  &&@@VV      ``%%@@@@@@@@@@QQ77    __::    !!QQ@@@@@@@@@@EE--  ``^^    @@@@[[  ``^^^^^^^^^^^^^^::``````````````````````````````````````zzAA::``==$$MMMM$$<<\r\n``````````````````````````\"\"``,,``````````````````````````````````````````    ,,__``    ``AAMMMMMMMMMMMMMMMMMM    ____    ``..      --==!!~~,,      ..``--      ;;zzcc,,      ``__\"\"          --==zzvv^^      ::^^^^,,      __cczz<<      ``^^^^    ::__''  ``^^^^^^^^^^^^^^\"\"``````````````````````````````````\\\\99MMMM$$VV$$MMMMMMMMYY\r\n````````````````````````\"\";;;;^^``````````````````````````````````````````              ``mmMMMMMMMMMMMMMMMMMM__--        ``````                  ``````\"\",,--            ``              --                ^^^^^^^^^^^^``            --::^^^^^^--          \"\"^^^^^^^^^^^^^^''````````````````````````````````^^BBMMMMMMMMMMMMMMMMMMDD''\r\n````````````````````````;;>>;;,,``````````````````````````````````````````````````````````,,++$$MMMMMMMMMMMMMMMM//''::````````````````------``````````::::::::::,,,,,,::::::::::''``````````````..----..````::^^^^^^^^^^^^^^^^::::^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^''````````````````````````````````>>MMMMMMMMMMMMMMMMMMMMff``\r\n````````````````````\"\",,>>>>^^````````````````````````````````````````````````````````````````XXMMMMMMMMMMMMMMMMSS^^,,``````````````````````````````,,::::::::::::::::::::::::::``````````````````````````````^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^__,,__::^^^^^^^^^^^^,,``````````````````````````````::SSMMMMMMMMMMMMMMMMMMMM]]``\r\n``````````````````,,``::>>>>==````````````````````````````````````````````````````````````````__VVwwMMMMMMMMMMMMEE``````````````````````````````````,,::::::::::::::::::::::::::``````````````````````````````''^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^````''::^^__^^^^``^^^^````````````````````````````\"\"''##MMMMMMMMMMMMMMMMMMMMMM,,\r\n````````````'',,````,,~~LL>>>>````````````````````````````````````````````````````````````````````33MMMMMMMMMMMM$$uu``````````````````````````````````::::::::::::::::::::::::::\"\"````````````````````````````````__^^^^^^^^^^^^^^^^^^^^^^^^^^__^^^^^^^^``````''\"\"``\"\"^^'',,^^``````````````````````````^^````cc00MMMMMMMMMMMMMMMMMMMM==\r\n````````````''``````;;mmvv>><<``LLxx``````````````````````````````````````````````````````````````vvHHeeMMMMMMMMMMee\"\"``````````````````````````````````,,::::::::::::::::::::::,,``````````````````````````````````,,^^^^^^^^^^^^^^^^^^^^::\"\"``\"\"^^,,\"\"``````````````''\"\"\"\"^^\"\"``````````````````````````````''wwMMMMMMMMMMMMMMMMMMMMff\r\n``````````````````__>>>>>>>>//'''',,``````````````````````````````````````````````````````````````````''DDMMMMMMMMZZ``````````````````````````````````````::::::::::::::::::::::,,``````````````````````````````````````,,____::,,\"\"''``````````````````````````````````````\"\",,``````''``````````````````````IIMMMMMMMMMMMMMMMMMMMMMMYY\r\n````````````````\"\"==>>>>>>>>VV,,````````````````````````````````````````````````````````````````````````^^VVMMMMEE``````````````````````````````````````\"\"\"\",,::::::::::::::::,,``````````````````````````````````````````````````````````````````````````````````````````````\"\"````````````````````````````YYMMMMMMMMMMMMMMMMMMMMMMMMcc\r\n``````````````''==>>ccJJ>>>>^^````\"\"ll````````````````````````````````````````````````````````````````````;;$$mmvv``````````````````````````````````````````````\"\"\"\"..      ,,\"\"``````````````````````````````````````````````````````````````````````````````````````````````````````````````````````````LLMMMMMMMMMMMMMMMMMMMMMMMMmm``\r\n``````````````::>>>>nnxx>>>>**``````__``````````````````````````````````````````````````````````````````````^^mm::````````````````````````````````````````````````..          ''``````````````````````````````````````````````````````````````````````````````````````````````````````````````````````````vvMMMMMMMMMMMMMMMMMMMMMMMM))^^\r\n``````````````^^>>>>>>>>>>LLII````''````````````````````````````````````````````````````````````````````````LLAA``\"\"``````````````````````````````````````````````    00QQ    --``````````````````````````````````````````````````````````''``''``````````````````````````````````````````````````````````^^MMMMMMMMMMMMMMMMMMMMMMkk,,==\r\n``````````````^^>>>>>>>>ZZ**\"\"``__qq``\"\"VV``````````````````````````````````````````````````````````````````::vv,,''``````````````````````````````````````````````..  ,,@@NN    ..````````````````````````````````````````````````````````,,^^<<,,````````````````````````````````````````````````````````^^MMMMMMMMMMMMMMMMMMMMMM55''``\r\n``````````````==>>>>>>>>UULL````````````^^``````````````````````````````````````````````````````````````````````;;``````````````````````````````````````````````````    ww@@>>    ``````````````````````````````````````````````````````''==>>;;``````````````````````````````````````````````````````````''\\\\DDMMMMMMMMMMMMMMMM00^^^^``\r\n````````````,,>>>>>>++~~>>==\"\"::````````````````````````````````````````````````````````````````````````````````````````````````````````````````````..------------``..  ``@@QQ    ..``````````````````````````````````````````````````\"\"^^>>==,,``````````````````````````````````````````````````````````````^^MMMMMMMMMMMMMMMMMM^^<<``\r\n````````````::>>>>>>SS((>>>><<SS````````````````````````````````````````````````````````````````,,``````````````````````````````````````````````````              ````    DD@@11    ``````````````````````````````````````````````''\"\"``;;>>>>^^````````````````````````````````````````````````````````````````ffOO%%MMMMMMMMMMMM11''``\r\n````````````^^>>>>>>>>>>>>>><<''````??``````````````````````````````````````````````````````````''``````````````````````````````````````````````````    55gg##    ````..  ;;@@QQ    ``````````````````````````````````````````\"\"\"\"````^^>>>>>>^^``````````````````````````````````````````````````````````````````'']]MMMMMMMMMMMMRR,,``\r\n````````````;;>>>>>>>>>>>>>>>>^^````vv``````````````````````````````````````````````````````````````````````````````````````````````````````````````    %%@@QQ    ``````    @@@@;;  ..````````````````````````````````````````''````''~~kk>>>>^^``ff^^``````````````````````````````````````````````````````````````DDAA##MMMMMMMMMM~~``\r\n````````````^^>>>>>>>>>>>>>>>>^^``````````````````````````````````````````````````````````````''````__``````````````````````````````````````````````    {{wwPP    ``````    kk@@66    ``````````````````````````````````````````````^^>>LL>>>>^^``LL\"\"``````````````````````````````````````````````````````````````````ccMMMMMMMM$$LL``\r\n````````````::>>>>>>>>>>>><<::''``````````````````````````````````````````````````````````````''````,,,,````````````````````````````````````````````            __==````--  CC@@QQ    ````````````````````````````````````````````::>>>>>>>>++55``````````````````````````````````````````````````````````````````````````ff%%MMMMxx````\r\n````````````^^>>>>>>>>>>>>>>,,``````````````````````````````````````````````````````````````````````````````````''``````````````````````````````````    ``^^^^^^CCQQ77``..  ==@@@@    ``````````````````````````````````````````,,>>>>ccLL>>>>,,````>>>>````````````````````````````````````````````````````````````````````KK$$RR::````\r\n````````\"\"^^>>>>>>>>>>>>>>>>^^````````````````````````````````````````````````````````````````````````````''^^==^^``````````````````````````````````````uuQQQQQQQQQQQQ^^``  ,,@@@@,,  ``````````````````````````````````````````;;>>>>AAvv>>>>,,````^^^^````````````````````````````````````````````````````````````````````^^77FF``````\r\n````````^^>>>>>>>>>>>>>>>>>>^^````````````````````````````````````````````````````````````````````````````==>>>>==''````````````````````````````````````AAQQQQQQQQQQQQss``  ..@@@@;;  ..````````````````````````````````````````;;>>>>>>>>>>{{yy``````````````````````````````````````````````````````````````````````````````ffZZ``````\r\n````````::>>>>>>>>>>>>>>>>>>,,``````````````````````````````````````````````````````````````````````````LL>>>>>>>>,,````````````````````````,,[[AAffnnDDQQQQQQQQQQQQQQDD``  --@@@@;;  ..````````````````````````````````````````>>>>>>>>LL++;;````((~~``>><<``````````````````````````````````````````````````````````````````77^^::````\r\n``````````==>>>>>>>>>>>>>>^^``````````````````````````````````````````````````````````````````````````<<PP>>>>>>>>\"\"``````````````````````````hhQQQQQQQQQQQQQQQQQQQQQQ##``  ``@@@@^^  ..``````````````````````````````````````,,>>>>>>>>vv88^^````,,''``^^^^``````````````````````````````````````````````````````````````````''``;;````\r\n``````````==>>>>>>>>>>==::````````````````````````````````````````````````````````````````;;zz``''^^__>>>>>>>>>>>>^^\"\"``\"\"``````````````````\"\"##QQQQQQQQQQQQQQQQQQQQQQBB``  __@@@@''  ````````````````````````````````````````^^>>>>>>\\\\>>>>^^````````````````````````````````````````````````````````````````````````````````````\"\"````\r\n``````````==>>>>>>>>>>,,````````````````````````````````````````````````````````````````````,,``,,//==!!33>>>>>>>>;;,,''``\"\"````````````````~~QQQQQQYY          ccQQQQMM``  \\\\@@@@    ````````````````````````````````````````;;>>>>LL[[LL>>==xxLL````````````````````````````````````````````````````````````````''````````````````````\r\n``````````__>>>>>>>>^^````````````````````````````````````````````````````````````````````````````\"\"~~**cc>>>>>>;;,,^^^^::\"\"``````````````^^QQQQQQQQxx          **QQQQQQbb  SS@@MM    ````````````````````````````````````````==>>>>>>>>>>>>>>^^````\"\"^^``````````````````````````````````````````````````````````''````````````````````\r\n````````````====^^\"\"``````````````````````````````````````````````````````````````````VV````<<??``__44>>>>>>>>>>\"\"\"\"^^^^^^^^::````````````DDQQQQQQQQxx  %%@@QQ  **QQQQQQ{{  $$@@TT    ``````````````````````````````````````''>>>>>>>>>>>>>>>>>>\"\"``^^nn````````````````````````````````````````````````````````````````````````````````\r\n````````````\"\"````````````````````````````````````````````````````````````````````````,,,,~~``,,``\"\";;}}SS>>HHnn``,,^^^^^^^^^^^^::''``````00QQQQQQQQxx  %%@@QQ  **QQQQQQ,,  @@@@,,  ..``````````````````````````````````````''==>>>>>>>>>>>>>>>>,,``````````````````````````````````````````````````````````````````'',,````````````````\r\n````````````````````````````````````````````````````````````````````````````````````````\"\"^^``ff__>>LLLL**>>\\\\LL,,____^^^^^^^^^^^^^^__\"\"''kkQQQQQQQQxx  ==11vv  **QQQQ00  //@@$$    ``````````````````````````````````````````;;>>>>>>>>>>>>;;^^````````````````````````````````````````````````````````````````,,````__````````````````\r\n````````````````````````````````````````````````````````````````````````````````````````'',,nn``^^SSff>>rrVV>>>>,,^^^^^^^^^^^^^^^^^^==kkBBQQQQQQQQQQxx          **QQQQzz  MM@@<<    ````````````````````````````````````````''==>>>>>>>>>>>>;;``````````````````````````````````````````````````````````````````````````````````````````\r\n``````````````````````````````````````````````````````````````````````````````````````''VV``^^^^;;>>>>>>LL\\\\>>>>^^^^^^^^^^^^^^^^^^^^rrQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ&&  ^^@@$$    ````````````````````````````````````````''^^>>>>>>>>>>>>>>>>,,````````````````````````````````````````````````````````````````````````````''^^==\"\"````\r\nLL````````````````````````````````````````````````````````````````````````````````````````::,,PP~~LL88LL>>>>>>==^^^^^^^^^^^^^^^^ff;;>>QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ77  ]]@@__    ``````````````````````````````````````''==>>>>>>>>>>>>>>>>>>,,``````````````````````````````````````````````````````````````````````````,,==>>>>^^````\r\n++````````````````````````````````````````````````````````````````````````````````;;<<``,,HH^^^^<<>>++>>**>>>><<^^^^^^^^^^^^ss66SSzzffOOggQQQQQQQQQQQQQQQQQQQQQQQQMM  ;;@@VV    ``````````````````````````````````````````;;>>>>>>>>>>>>>>>><<``````````````````````````````````````````````````````````````````````````''<<>>>>>>==````\r\n00''``````````````````````````````````````````````````````````````````````````````__^^````^^^^((JJ>>>>\\\\GG>>>>;;^^^^^^^^^^^^**$$QQQQ$$IIVVQQQQQQQQQQQQQQQQQQggggQQ55  AAOO    --``````````````````````````````````````````::>>>>>>>>>>>>>>>>,,``````````````````````````````````````````````````````````````````````````xx((>>>>>>;;````\r\n66\"\"````````````````````````````````````````````````````````````````````````^^''``````````__^^>>~~>>>>>>LL>>>>^^^^^^^^^^^^^^^^;;uu88]]ggQQQQQQQQQQQQQQWWee++::\"\"zzqq--        ````````````````````````````````````````````,,>>>>>>>>>>>>==,,````````````````````````````````````````````````````````````````vv,,``\"\"``^^>>>>>>>>>>>>\"\"''\r\n,,``````````````````````````````````````````````````````````````````````````zz__````zzLL44^^^^;;>>>>>>>>>>>>>>^^^^^^^^^^^^^^;;^^^^^^^^^^++88WWQQQQQQQQQQ{{\"\"````````        ;;\"\"``````````````````````````````````````````::>>>>>>>>>>==''``````````````````````````````````````````````````````````````````;;''``11>>>>CCcc>>>>>>>>^^\"\"\r\n^^``````````````````````````````````````````````````````````````````````````````````````^^^^VVzz>>>>>>>>>>>><<^^^^^^^^^^cccc\\\\\\\\^^^^^^^^^^^^LL$$QQQQQQkk^^^^****^^^^((__,,hh,,\"\"````````````````````````````````````````````<<>>>>>>>>::````````````````````````````````````````````````````````````````````````````^^>>}}~~>>>>>>^^__^^\r\nuu````````````````````````````````````````````````````````````````````````````````{{;;^^++^^<<>>>>>>>>>>>>>>^^^^^^^^^^^^^^^^**==~~^^^^^^^^^^^^;;11{{++^^^^^^^^;;::^^\"\"````````<<````````````````````````````````````````````::>>>>^^,,````````````````````````````````````````````````````````````````;;LL````22,,``ff))>>>>>>>><<``,,^^\r\nPP``````````````````````````````````````````````````````````````````````````````````::^^ss;;<<ZZLL==>>>>>>;;^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<<TTvv^^^^^^^^^^,,````````````````````````````````````````````````````````````''::''````````````````````````````````````````````````````````````````````,,__^^\"\"``````\"\"==VVccLLPP^^'',,^^\r\nkk,,````````````````````````````````````````````````````````````````````````````````^^^^^^^^^^ZZ==;;>>>>>>^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^``````````````````````````````````````````````````````````````````````````````````````````````````````````````````````````````````````````~~::\"\"PP,,>>>>zzLL>>77<<\"\"::^^\r\n00``````````````````````````````````````````````````````````````````````````````````;;HH^^^^^^^^^^^^>>>>;;^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^,,``````````````````````````````````````````````````````````````````````````````````````````````````````````````````````````````````````````^^::``<<NNLL>>HHcc>><<,,^^^^\r\n$$::````````````````````````````````````````````````````````````````````````````````__;;^^^^^^^^^^^^>>>>^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^::``````````````````````````````````````````````````````````````````````````````````````````````````````````````````````````````````````**++<<^^,,==**>>>>nn**>>;;^^^^^^\r\nff``````````````````````````````````````````````````````````````````````````````````,,^^^^^^^^^^^^^^<<>>^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^,,``````````````````````````````````,,``````;;YY44````````````````````````````````````````````````````````````````````````````````````````''``^^88>>++ff>>>>>>>>;;^^^^^^\r\n::,,,,^^````````````````````````````````````````````````````````````````````````````\"\"^^^^^^^^^^^^;;<<;;^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^,,,,,,``````````````````````````````````vv^^````77MMMMBB``````````````````````````````````````````````````````````````````````````````````;;````//++^^^^==vv))>>>>>>>>;;^^^^^^\r\n;;^^''````````````````````````````````````````````````````````````````````````````````^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^::````````````````````````````````````\"\"SS[[zz''!!MMMMMMMMuu````````````````````````````````````````````````````````````````````````````````rr''``\"\"^^^^ff>>>>>>TTss>>>>^^^^^^^^\r\n^^``````````````````````````````````````````````,,::::,,'',,``````````````````````````,,^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^,,``````````````````````````````````ff]]MMMMMM%%MMMMMMMMMMss``````````````````````````````````````````````````````````````````````````''````````````^^^^hhLL>>>>LLLL>>==^^^^^^^^\r\n^^````````````````````````````````'',,::::,,,,::::::::::::::\"\"``````````````````````````^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\"\"````````````````````````````````::$$MMMMMMMMMMMMMMMMMMww````````````````````````````````````````````````````````````````````````````44``````SS^^YY^^^^<<>>>>>>>>>>>>==^^^^^^^^\r\n";

    [SetUp]
    public void Setup()
    {
      mockExtensionChecks = new Mock<IExtensionChecks>();
      mockResizeImage = new Mock<IResizeImage>();
      mockImageConverter = new Mock<IImageConverter>();

      mockExtensionChecks.Setup(m => m.IsImage(It.IsAny<string>()))
        .Returns(true);

      mockResizeImage.Setup(m => m.Resize(It.IsAny<Bitmap>()))
        .Returns(resizedImage);

      mockImageConverter.Setup(m => m.ReadPixels(It.IsAny<Bitmap>()))
        .Returns(testAscii);

      imageController = new ImageController(mockExtensionChecks.Object, mockResizeImage.Object, mockImageConverter.Object);
    }

    [Test]
    public async Task UploadImage_SubmitFormData_ReturnsAscii()
    {
      //Arrange;
      var stream = new MemoryStream();
      var image = new Bitmap(@"Test Data\TestOriginalImage.png");

      image.Save(stream, ImageFormat.Png);
      byte[] imageBytes = stream.ToArray();

      IFormFile file = new FormFile(new MemoryStream(imageBytes), 0, imageBytes.Length, "0", "TestOriginalImage.png");

      FormFileCollection files = new FormFileCollection { file };
      formData = new FormCollection(null, files);

      //Act
      var ascii = await imageController.UploadImage(formData);

      //Assert
      var objectResult = ascii as ObjectResult;
      var value = objectResult.Value;

      Assert.AreEqual(value, testAscii);
    }
  }
}